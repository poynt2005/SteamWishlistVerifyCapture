!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).SteamWishlistVerifyCapture={})}(this,(function(e){"use strict";function n(e,n,t,r,i,a,o){try{var u=e[a](o),c=u.value}catch(e){return void t(e)}u.done?n(c):Promise.resolve(c).then(r,i)}function t(e){return function(){var t=this,r=arguments;return new Promise((function(i,a){var o=e.apply(t,r);function u(e){n(o,i,a,u,c,"next",e)}function c(e){n(o,i,a,u,c,"throw",e)}u(void 0)}))}}function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){var e=t(regeneratorRuntime.mark((function e(n){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==window.GM&&void 0!==window.GM.xmlHttpRequest){e.next=2;break}return e.abrupt("return",Promise.reject({status:"failed",message:"Not in the GM context"}));case 2:return t=function(e){return new Promise((function(n){var t=e.id,r=e.url,i={status:"",data:{binary:null,id:t},message:""};GM.xmlHttpRequest({url:r,method:"GET",responseType:"blob",onload:function(e){return i.status="success",i.data.binary=e.response,n(i)},onerror:function(){return i.status="failed",i.message="download resource failed",n(i)}})}))},e.abrupt("return",Promise.all(n.map((function(e){return t(e)}))));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),a=function(){var e=t(regeneratorRuntime.mark((function e(n){var t,r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)}))},r=n.querySelectorAll("*[src]"),a=[],r.forEach((function(e){var n=t();a.push({id:n,url:e.src}),e.setAttribute("id",n),e.src=""})),e.prev=4,e.next=7,i(a);case 7:o=e.sent,e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",Promise.reject(e.t0));case 13:return o.forEach((function(e){var t=e.status,r=e.data,i=e.message;if("success"==t){var a=r.binary,o=r.id,u=URL.createObjectURL(a);n.getElementById(o).src=u}else{r.binary;var c=r.id;n.getElementById(c).errorMessage=i}})),e.abrupt("return",n);case 15:case"end":return e.stop()}}),e,null,[[4,10]])})));return function(n){return e.apply(this,arguments)}}(),o=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.originDOC=null,this.doc=null,this.domElement=null}var n,i,o,u;return n=e,i=[{key:"initPage",value:function(){var e,n,t,r;this.originDOC=(e=document.getElementById("global_header"),n=document.querySelector(".responsive_store_nav_ctn_spacer"),t=Array.from(document.querySelectorAll("#tabletGrid .page_content_ctn > div")).filter((function(e,n){return n<=3})).map((function(e){return e.outerHTML})),r='\n        <div class="responsive_page_content">\n            <div id="global_header">\n                '.concat(e.innerHTML,'\n            </div>\n            <div class="responsive_page_template_content>\n                <div class="game_page_background game">\n                    <div class="page_content_ctn">\n                        ').concat(n.innerHTML,"     \n                        ").concat(t,"\n                    </div>\n                </div>\n            </div>\n        </div>\n    "),(new DOMParser).parseFromString(r,"text/html"))}},{key:"buildPage",value:(u=t(regeneratorRuntime.mark((function e(n){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a(this.originDOC);case 3:return this.doc=e.sent,(t=document.createElement("div")).appendChild(this.doc.body),document.body.appendChild(t),e.next=9,html2canvas(t);case 9:this.domElement=e.sent,t.remove(),"function"==typeof n&&n(null),e.next=21;break;case 14:if(e.prev=14,e.t0=e.catch(0),"function"!=typeof n){e.next=20;break}return e.abrupt("return",n(e.t0));case 20:return e.abrupt("return",Promise.reject(e.t0));case 21:case"end":return e.stop()}}),e,this,[[0,14]])}))),function(e){return u.apply(this,arguments)})},{key:"downloadImage",value:function(e){var n=this;return null==this.domElement?"function"==typeof e?e({message:"Canvas not initalized"}):Promise.reject({message:"Canvas not initalized"}):new Promise((function(t){n.domElement.toBlob((function(n){var r=document.createElement("a");if(r.download=document.getElementById("appHubAppName").innerText.trim(),r.href=URL.createObjectURL(n),r.click(),"function"==typeof e)return e(null);t()}),"image/png")}))}},{key:"copyToClipboard",value:function(e){var n=this;return null==this.domElement?"function"==typeof e?e({message:"Canvas not initalized"}):Promise.reject({message:"Canvas not initalized"}):new Promise((function(t){n.domElement.toBlob((function(n){window.navigator.clipboard.write([new ClipboardItem({"image/png":n})]).then((function(){if("function"==typeof e)return e(null);t()}))}),"image/png")}))}}],o=[{key:"html2canvas",get:function(){return html2canvas}}],i&&r(n.prototype,i),o&&r(n,o),e}();e.InstallLib=function(){var e="https://html2canvas.hertzen.com/dist/html2canvas.min.js";return{checkInstalled:function(){return"function"==typeof window.html2canvas},install:function(n){return new Promise((function(t,r){var i=document.createElement("script");i.src=e,document.head.appendChild(i),i.addEventListener("load",(function(){return"function"==typeof n&&n(null),t()})),i.addEventListener("error",(function(){return"function"==typeof n&&n(!0),r()}))}))},set libCDN(n){e=n},get libCDN(){return e}}},e.default=o,Object.defineProperty(e,"__esModule",{value:!0})}));
